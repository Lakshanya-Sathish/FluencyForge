<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reading | FluencyForge</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  background:#f6f8ff;
  font-family:Poppins,sans-serif;
  margin:0;
}
.container{
  max-width:900px;
  margin:40px auto;
  background:#fff;
  padding:30px;
  border-radius:16px;
}
.question{margin:20px 0}
label{display:block;margin:6px 0;cursor:pointer}
button{
  margin-top:20px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#4a90e2;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
.result{
  margin-top:20px;
  font-weight:600;
  text-align:center;
}
.card{
  padding:20px;
  margin:15px 0;
  border-radius:12px;
  border:2px solid #4a90e2;
  cursor:pointer;
  text-align:center;
}
.locked{
  opacity:0.4;
  pointer-events:none;
}
</style>
</head>

<body>

<!-- LEVEL SELECTION -->
<div class="container" id="levelContainer">
  <h1>Reading Practice</h1>

  <div class="card" onclick="openModules('easy')">
    <h2>Beginner</h2>
  </div>

  <div class="card locked" id="intermediateCard" onclick="openModules('intermediate')">
    <h2>Intermediate</h2>
  </div>

  <div class="card locked" id="advancedCard" onclick="openModules('advanced')">
    <h2>Advanced</h2>
  </div>
</div>

<!-- MODULE SELECTION -->
<div class="container" id="moduleContainer" style="display:none">
  <h1 id="moduleTitle"></h1>
  <div id="modules"></div>
  <button onclick="backToLevels()">â¬… Back</button>
</div>

<!-- READING CONTENT -->
<div class="container" id="readingContainer" style="display:none">
  <h1 id="title"></h1>
  <p id="passage"></p>

  <div id="questions"></div>

  <button id="submitBtn">Submit</button>
  <div class="result" id="result"></div>
</div>

<script>
let correctAnswers = [];
let currentLevel = null;
let currentModule = null;

/* LOAD PROGRESS */
let progress = JSON.parse(localStorage.getItem("readingProgress")) || {
  easy: null,
  intermediate: null,
  advanced: null
};

/* UNLOCK LEVELS */
if(progress.easy >= 51){
  document.getElementById("intermediateCard").classList.remove("locked");
}
if(progress.intermediate >= 51){
  document.getElementById("advancedCard").classList.remove("locked");
}

/* OPEN MODULE LIST */
function openModules(level){
  currentLevel = level;

  document.getElementById("levelContainer").style.display = "none";
  document.getElementById("moduleContainer").style.display = "block";
  document.getElementById("readingContainer").style.display = "none";

  document.getElementById("moduleTitle").textContent =
    level.charAt(0).toUpperCase() + level.slice(1) + " Modules";

  const box = document.getElementById("modules");
  box.innerHTML = "";

  for(let i=1;i<=10;i++){
    box.innerHTML += `
      <div class="card" onclick="openModule('${level}',${i})">
        Module ${i}
      </div>
    `;
  }
}

/* OPEN MODULE */
function openModule(level, module){
  currentLevel = level;
  currentModule = module;

  document.getElementById("moduleContainer").style.display = "none";
  document.getElementById("readingContainer").style.display = "block";

  loadReading();
}

/* LOAD READING */
async function loadReading(){
  try{
    let jsonFile =
      currentLevel === "easy" ? "content/reading/beginner.json" :
      currentLevel === "intermediate" ? "content/reading/intermediate.json" :
      "content/reading/advanced.json";

    const res = await fetch(jsonFile);
    if(!res.ok) throw new Error("JSON not found");

    const data = await res.json();
    const index = currentModule - 1;
    const passage = data.passages[index];

    document.getElementById("title").textContent = passage.title;
    document.getElementById("passage").textContent = passage.text;

    const qBox = document.getElementById("questions");
    qBox.innerHTML = "";
    correctAnswers = [];

    passage.questions.forEach((q,i)=>{
      correctAnswers.push(q.answer);
      qBox.innerHTML += `
        <div class="question">
          <h3>${i+1}. ${q.question}</h3>
          ${Object.entries(q.options).map(([k,v])=>`
            <label>
              <input type="radio" name="q${i}" value="${k}">
              (${k}) ${v}
            </label>
          `).join("")}
        </div>
      `;
    });

    document.getElementById("result").textContent = "";

  }catch(err){
    alert("Failed to load reading content");
  }
}

/* SUBMIT */
document.getElementById("submitBtn").addEventListener("click", ()=>{
  let score = 0;

  correctAnswers.forEach((ans,i)=>{
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    if(sel && sel.value === ans) score++;
  });

  const percent = Math.round((score / correctAnswers.length) * 100);

  document.getElementById("result").textContent =
    `Score: ${score}/${correctAnswers.length} (${percent}%)`;

  progress[currentLevel] = percent;
  localStorage.setItem("readingProgress", JSON.stringify(progress));

  if(currentLevel === "easy" && percent >= 51){
    document.getElementById("intermediateCard").classList.remove("locked");
  }
  if(currentLevel === "intermediate" && percent >= 51){
    document.getElementById("advancedCard").classList.remove("locked");
  }
});

/* BACK */
function backToLevels(){
  document.getElementById("moduleContainer").style.display = "none";
  document.getElementById("readingContainer").style.display = "none";
  document.getElementById("levelContainer").style.display = "block";
}
</script>

</body>
</html>
