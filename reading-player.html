<script>
let correctAnswers = [];

// 1️⃣ GET PID FROM URL
const params = new URLSearchParams(window.location.search);
const pid = params.get("pid"); // example: R-B-1

async function loadReading(){
  const res = await fetch("../content/reading/beginner.json");
  const data = await res.json();

  // 2️⃣ FIND PASSAGE BY PID
  let passage;

  if(pid){
    passage = data.passages.find(p => p.id === pid);
  }

  // 3️⃣ FALLBACK (if pid missing or wrong)
  if(!passage){
    passage = data.passages[0];
  }

  // 4️⃣ RENDER PASSAGE
  document.getElementById("title").textContent = passage.title;
  document.getElementById("passage").textContent = passage.text;

  const qBox = document.getElementById("questions");
  qBox.innerHTML = "";
  correctAnswers = [];

  // 5️⃣ RENDER QUESTIONS
  passage.questions.forEach((q, i) => {
    correctAnswers.push(q.answer);

    qBox.innerHTML += `
      <div class="question">
        <h3>${i+1}. ${q.question}</h3>

        ${Object.entries(q.options).map(([key, value]) => `
          <label>
            <input type="radio" name="q${i}" value="${key}">
            (${key}) ${value}
          </label>
        `).join("")}
      </div>
    `;
  });
}

// 6️⃣ SUBMIT LOGIC
document.getElementById("submitBtn").onclick = () => {
  let score = 0;

  correctAnswers.forEach((ans, i) => {
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    if(selected && selected.value === ans) score++;
  });

  document.getElementById("result").textContent =
    `Score: ${score} / ${correctAnswers.length}`;
};

loadReading();
</script>
