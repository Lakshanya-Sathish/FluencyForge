<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Listening | FluencyForge</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../style.css">
<style>
body{background:#f6f8ff;font-family:Poppins}
.container{max-width:900px;margin:40px auto;background:#fff;padding:30px;border-radius:16px}
button{padding:10px 16px;border:none;border-radius:10px;background:#1abc9c;color:#fff;cursor:pointer}
</style>
</head>

<body>

<div class="container">
  <h1>Listening Practice</h1>

  <audio id="audio" src="../assets/audio/sample.mp3"></audio>
  <p>Replays left: <span id="count">2</span></p>
  <button onclick="playAudio()">Play</button>

  <div id="questions"></div>
  <button onclick="submit()">Submit</button>

  <div id="result"></div>
</div>

<script>
let plays = 2;
let correct = [];

function playAudio(){
  if(plays<=0) return alert("No replays left");
  document.getElementById("audio").play();
  plays--;
  document.getElementById("count").textContent = plays;
}

async function loadListening(){
  const res = await fetch("../content/listening/beginner.json");
  const data = await res.json();
  const mod = data.modules[0];

  const qBox = document.getElementById("questions");
  mod.questions.forEach((q,i)=>{
    correct.push(q.answer);
    qBox.innerHTML += `
      <div>
        <h3>${i+1}. ${q.question}</h3>
        ${q.options.map(o=>`
          <label><input type="radio" name="q${i}" value="${o}"> ${o}</label>
        `).join("")}
      </div>`;
  });
}

function submit(){
  let score=0;
  correct.forEach((a,i)=>{
    const s=document.querySelector(`input[name=q${i}]:checked`);
    if(s && s.value===a) score++;
  });
  document.getElementById("result").textContent=`Score: ${score}/${correct.length}`;
}

loadListening();
</script>

</body>
</html>
